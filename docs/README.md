# 프로젝트 목표 - 크리스마스 프로모션
- 미션은 기능 요구 사항, 프로그래밍 요구 사항, 과제 진행 요구 사항 세 가지로 구성되어 있으며 3가지 요구 사항을 만족해야 한다 
- 기능을 구현하기 전에 기능 목록을 만들고, 기능 단위로 커밋 하는 방식으로 진행한다.
- 기능 요구 사항에 기재되지 않은 내용은 스스로 판단하여 구현한다.

## 🚀 기능 요구 사항

12월 이벤트를 위한 개발 요청
- 12월 이벤트 상황에 맞는 프로그램을 개발한다
- 예산 걱정 없이 상한선을 따로 고려하지 않는다
- 메뉴와 달력 이미지를 참고하여 12월 이벤트 계획과 내용을 이해하고 프로그램에 반영할 수 있도록 한다 

### 메뉴
```
<애피타이저>
양송이수프(6,000), 타파스(5,500), 시저샐러드(8,000)

<메인>
티본스테이크(55,000), 바비큐립(54,000), 해산물파스타(35,000), 크리스마스파스타(25,000)

<디저트>
초코케이크(15,000), 아이스크림(5,000)

<음료>
제로콜라(3,000), 레드와인(60,000), 샴페인(25,000)
```
메뉴는 에피타이저, 메인, 디저트, 음료로 구성되어 있으며 종류별 서로 다른 음식 메뉴가 존재한다
- 음식 종류는 서로 다른 음식 메뉴를 가지고 있다 
- 음식 메뉴는 가격을 가지고 있다 ex) 양송이 수프 - 6,000원  

### 12월 이벤트 계획
이벤트의 진행 방식과 목적을 이해한다
- 중복된 할인과 증정을 허용한다 -> 고객들이 혜택을 많이 받는 것을 체감한다 
- 지난 5년 중 최고의 판매 금액을 12월에 달성한다 
- 12월 이벤트 참여 고객의 5%가 내년 1월 새해 이벤트에 참여할 수 있도록 한다 

이벤트 계획은 5가지로 구분할 수 있으며 이벤트 기간, 할인 금액, 증정이 서로 다르게 구성된다
- 크리스마스 디데이 할인 
  - [x] **12.01 - 12.25일까지 진행한다**
  - [x] 할인 금액의 시작은 1000원이다
  - [x] 하루를 지날수록 100원씩 할인 금액이 증가한다 ex) 100원 - 200원 ....
  - [x] 25일 기준 해당 이벤트의 최대 할인 금액은 3400원이다 
  - 총 주문 금액에서 해당 할인 금액을 제외한다

- 평일 할인 (일-목요일)
  - [x] **12.01 - 12.31**일까지 진행한다 
  - [x] **일요일에서 목요일**까지 적용되는 할인이다
  - [x] **디저트 메뉴**를 한 개당 2,023원 할인한다 
  
- 주말 할인 (금-토요일)
  - [x] **12.01 - 12.31**일까지 진행한다
  - [x] **금요일에서 토요일**까지 적용되는 할인이다
  - [x] **메인 메뉴**를 한 개당 2,023원 할인한다

- 특별 할인 
  - [x] **12.03, 10, 17, 24 ,25, 31** 총 6일만 진행한다 
  - [x] **총 주문 금액에서 100원을 할인한다**

- 증정 이벤트 
  - [x] **12.01 - 12.31**일까지 진행한다
  - **할인 전 총 주문 금액** 12만원 이상일 때 적용된다 
  - [x] 샴페인 1개 (25,000원)을 증정한다  

### 헤택 금액에 따른 12월 이벤트 배지 부여
혜택 금액에 따라 서로 다른 이벤트 배지를 부여한다
- [x] 5천원 이상: 별
- [x] 1만원 이상: 트리
- [x] 2만원 이상: 산타

### 12월 이벤트 관련 유의사항
- 이벤트 적용 가능한 금액은 총 주문 금액을 기준으로 1만원 이상이다
- 음료만 주문하는 것은 불가능하다
- 메뉴는 한 번에 최대 20개까지만 주문이 가능합니다 
---

### 흐름 그리고 핵심 기능
1. 날짜를 통해 적용 가능한 혜택을 확인할 수 있다
  - 날짜마다 적용되는 혜택 내역이 서로 다르다 
    - 날짜 정보, 혜택 정보가 존재해야 한다 
    - --> 혜택에게 날짜를 전달한다 
    - <-- 적용할 수 있는 혜택을 반환한다
  - 날짜 정보를 전달했을 때 적용 가능한 혜택을 확인할 수 있다
    - 복수의 경우도 가능하다
    
```
제한 조건을 확인해야 한다
- 이벤트 적용 가능한 금액은 총 주문 금액을 기준으로 1만원 이상이다 Receipt 에서 확인 
- 음료만 주문하는 것은 불가능하다 - AcceptedOrders 검증~ 
- 메뉴는 한 번에 최대 20개까지만 주문이 가능합니다 - AcceptedOrders 검증 ~
```

2. 확인된 혜택을 통해 주문한 메뉴로부터 할인 금액을 확인할 수 있다
  - 적용 가능한 혜택과 할인 전 총 주문 금액을 유지하는 Receipt (**증정 여부까지 확인이 된 상황**)
  - Receipt의 TotalPrice를 확인한다 (Day, 총 주문 금액 정보가 필요하다)
    - 1만원보다 적으면 AcceptedOrders를 초기화 해야 한다
    - 생성자에서 검증을 진행한다
    
  - 적용 가능한 혜택을 통해서 할인 금액을 확인한다 
    - 증정 메뉴 출력은 적용 가능한 혜택 내부에 PROMOTION_EVENT의 존재 여부로 확인이 가능하다 
    - OutputView --> Receipt (PROMOTION_EVENT가 존재하는 지 여부를 반환하여 OutputView는 증정 메뉴 출력 여부를 결정한다)
  
  - 적용 가능한 혜택을 통해서 할인 받는 금액을 확인하다
    - 각 할인 별로 금액을 유지하고 있어야 한다 EventStatus(EnumMap<DICOUNT_TYPE, 금액>) 이를 OutputView에게 전달해야 한다
    - AcceptedOrders (수용한 주문들) 을 가지고 있어야 한다. 주문 정보를 가지고 오기 위함이다 
      - TotalPrice 필요한지 생각하기 
    - 각 할인의 합(= 총혜택 금액)을 OutputView에게 전달한다 (할인들의 합은 EventStatus의 역할)
  - 할인 후 예상 결제 금액
    - 할인의 합을 EventStatus로 부터 조회한다 
    - PROMOTION_EVENT으로 증정된 경우 25000원을 차감된 값을 OutputView에게 전달해야 한다
      - EnumMap DISCOUNT_TYPE에 PROMOTION_EVENT가 존재하는 경우
    - PROMOTION_EVENT가 적용되지 않은 경우 할인의 합을 그대로 OutputView에게 전달해야 한다 
      - EnumMap DISCOUNT_TYPE에 PROMOTION_EVENT가 존재하지 않는 경우 

3. 할인 금액을 통해 새해 이벤트 배지를 확인할 수 있다 
  - 총혜택 금액에 따라 이벤트 배지를 부여한다 
  - 차등적으로 이벤트 배지를 부여한다 


### 출력 예시를 반영한 기능 명세 사항
- 고객들이 식당에 방문할 날짜와 메뉴를 미리 선택하면 이벤트 플래너가 주문과 이벤트 관련 내용을 출력한다 
  - 식당에 방문할 날짜와 메뉴를 입력받는다
  - 주문 메뉴, 할인 전 총주문 금액, 증정 메뉴, 혜택 내역, 총혜택 금액, 할인 후 예상 결제 금액, 12월 이벤트 배지 내용을 출력한다

- 식당 예상 방문 날짜를 입력한다 
  - 예상 방문 날짜는 숫자만 입력받을 수 있다
  - 숫자의 범위는 1일에서 31일까지만 가능하다
    - **예외** 1이상 31이하의 숫자가 아닌 경우
    - **모든 에러 메시지는 "[ERROR]"로 시작하도록 작성한다**
    - **예외 처리** 1 이상 31 이하의 숫자가 아닌 경우, "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."라는 에러 메시지를 출력한다
    - **예외 처리** 재입력을 받는다 

- 주문하실 메뉴와 개수를 입력한다 (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
  - "$메뉴명-$개수" 형태로 입력한다
  - 복수의 메뉴를 주문하는 경우 콤마(',')로 구분해서 입력한다 
  - 메뉴 개수는 1이상의 숫자만 입력할 수 있다
    - **예외** 메뉴의 개수를 숫자로 입력하지 않은 경우
    - **예외** 메뉴의 개수를 0으로 입력한 경우
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 메뉴판에 존재하는 메뉴만 입력할 수 있다
    - **예외** 메뉴판에 존재하지 않는 메뉴를 입력한 경우
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 중복 메뉴를 입력할 수 없다 
    - **예외** 중복 메뉴를 입력한 경우 
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 형식에 맞지 않게 입력할 수 없다 
    - **예외** 형식에 맞게 입력하지 않은 경우
      - **예외 1** "$메뉴명-$메뉴 개수"의 형식을 지키지 않은 경우
      - **예외 2** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 구분자를 활용하지 않은 경우 
      - **예외 3** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 정해진 구분자 콤마(',')가 아닌 다른 문자를 명시한 경우 
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다

```
할인 정보를 담는 클래스를 만든다고 생각하자 (영수증을 생각하자)
할인 적용 받기 전의 정보를 가지고 있다
가능한 discount 리스트, 각 discount를 적용받은 횟수를 저장해야 한다

영수증은 할인전 총 주문 금액, 적용 가능한 이벤트 리스트를 유지한다
생성하면서 총 주문 금액에게 프로모션 적용이 가능한지를 확인하고 
최종적으로 적용 가능한 이벤트만 남긴다 
```

- [x] 할인 전 총 주문 금액을 출력한다
  - 할인을 적용하기 전의 가격의 총합을 출력한다 
  - Order 정보를 확인하여 MenuPrice * Quantity 값을 반환한다 
  - 각각의 반환된 값들의 합을 구하고
  - 이를 출력할 수 있도록 한다 - TotalPrice 생성

- 증정 메뉴를 출력한다
  - 1일 ~ 31일까지 진행되는 증정 이벤트의 조건을 충족하면 샴페인을 증정한다
  - 할인 전 최종 금액을 테스트 인자로 전달한다 (인자 값)
    - 할인 받기 전 총 주문 금액이 120000원 이상이 경우
    - 샴페인 (25,000원) 을 증정한다



- 혜택 내역을 출력한다 
  - 적용 가능한 혜택을 출력한다
  - 적용하지 못하는 혜택은 출력하지 않는다 
  - 증정된 샴페인이 있다면 포함한다 

- 총 혜택 내역을 출력한다 
  - 이벤트로 할인 받은 금액의 총액을 구한다
  - 증정된 상품의 금액을 포함한다 
    - 증정 이벤트로 샴페인을 증정한 경우 25,000원을 포함하고 출력한다   

- 할인 후 예상 결제 금액을 출력한다 
  - 총 주문 금액에서 할인 금액을 차감한 금액을 출력한다
    - 증정된 샴페인의 가격을 할인 금액에 포함하지 않는다 

- 12월 이벤트 배지를 출력한다
  - 0원 - 4999원 : 없음 
  - 5000원 - 9999원: 별
  - 1만원 이상 - 19999원: 트리
  - 2만원 이상 ~ : 산타 
  


---

## 단위 테스트 (Unit Test)
모든 메뉴는 메뉴 종류, 메뉴 이름과 메뉴 가격을 포함한다 (Enum으로 표현하자) ex) 에피타이저, 양송이 스프, 6000원
- [x] 메뉴 종류를 관리하는 Enum
- [x] 메뉴 이름값을 Wrapping 클래스
- [x] 메뉴의 가격을 Wrapping 클래스

모든 이벤트는 적용 기간, 할인 금액
- 적용 기간을 관리하는 Enum ( ex.1-31, 1-25 / Predicate - 조건으로 표현한다 )
  - 주말
  - 평일
  - 특정한 날짜는 7로 나눈 나머지를 적용
  - 특별한 날짜는 따로 표기하는 방식으로 
- 할인 금액을 Wrapping 하는 클래스 
  - 단순히 하나의 메뉴를 고려한다 (한 종목에 하나의 종류를 생각한다)
  - 메뉴의 수를 고려하지 않고 상품 종류에 따른 할인 금액을 기준으로 생성한다

혜택 금액에 따라 서로 다른 이벤트 배지를 부여한다
- 혜택 금액을 인자로 전달하여 비교한다 
  - 기준을 Predicate<>로 표현한다  
  - 5천원 이상: 별
  - 1만원 이상: 트리
  - 2만원 이상: 산타

Day를 넘겨주면 할인 적용 할 수 있는 이벤트를 List<>로 반환한다 (Day - DiscountType)
- 적용 가능한 이벤트를 가지고 온다 - DiscountEvent 가지고 오면
  - 단위 당 할인 금액을 확인할 수 있다
  - Day를 전달해서 적용 가능한 이벤트를 먼저 확인

#### 입력된 값을 활용하여 DTO 형성, Mapper 클래스를 활용하여 Entity로 변환한다 

```
식당에 방문할 날짜와 메뉴를 입력받는다 (Day)
  - 입력받는 날짜 (DateDTO)
  - 입력받는 메뉴 (MenuDTO)
  - DTO로 받는다
  - DTO to Entity로 변환하는 Mapper 클래스를 유지한다
 ``` 
- DayDTO에서는 공통적인 검증을 진행한다
  - 수를 입력해야 한다
  - **예외** 수가 아닌 문자를 입력한 경우 
  - **예외** 공백 혹은 null을 입력한 경우 

- 예상 방문 날짜는 숫자만 입력받을 수 있다 (Day)
  - 숫자의 범위는 1일에서 31일까지만 가능하다
    - **예외** 1이상 31이하의 숫자가 아닌 경우
    - **모든 에러 메시지는 "[ERROR]"로 시작하도록 작성한다**
    - **예외 처리** 1 이상 31 이하의 숫자가 아닌 경우, "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."라는 에러 메시지를 출력한다
    - **예외 처리** 재입력을 받는다
    
구매 내역을 형성한다 
- 구매 내역은 "$메뉴명-$개수" 형태로 입력한다 OrderDTO
  - 복수의 메뉴를 주문하는 경우 콤마(',')로 구분해서 입력한다 - OrderDTO에서 검증 
  - 메뉴 개수는 1이상의 숫자만 입력할 수 있다 - OrderQuantity 에서 검증 
    - **예외** 메뉴의 개수를 숫자로 입력하지 않은 경우 - orderDTO 검증 
    - **예외** 메뉴의 개수를 0으로 입력한 경우 - menuQuantity 검증 
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 메뉴판에 존재하는 메뉴만 입력할 수 있다 - MenuProduct 에서 검증 
    - **예외** 메뉴판에 존재하지 않는 메뉴를 입력한 경우 --> MenuProduct Enum에서 처리함 
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 중복 메뉴를 입력할 수 없다 - AcceptedOrders 검증
    - **예외** 중복 메뉴를 입력한 경우
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 형식에 맞지 않게 입력할 수 없다 - OrderDTO에서 검증한다
    - **예외** 형식에 맞게 입력하지 않은 경우
      - **예외 1** "$메뉴명-$메뉴 개수"의 형식을 지키지 않은 경우
      - **예외 2** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 구분자를 활용하지 않은 경우
      - **예외 3** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 정해진 구분자 콤마(',')가 아닌 다른 문자를 명시한 경우
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다

```
구매 내역을 한꺼번에 테스트를 진행하려다 보니 여러 클래스가 동시 다발적으로 생성되면서 살짝 꼬이기 쉽겠다는 생각이 바로 들었다
예외, 성공 케이스를 기준으로 하나의 검증을 마무리 지었다면 해당 검증에 대한 테스트를 바로 바로 진행하는 것이 좋겠다는 생각이 들었다  
```
할인 전 총 주문 금액을 출력한다
- [x] AcceptedOrders가 유지하는 Order은 MenuProduct, Quantity를 유지한다
  - MenuProduct의 price를 조회한다
  - price와 Quantity를 곱한다 
  - 곱한 값들을 모두 합한다 

적용 가능한 이벤트를 가지고 온다 (-> DiscountType (Day) Day 정보를 확인해서 가능한 이벤트 List<DiscountType(이벤트 관련 정보)>을 반환한다
  - PromotionEventTest (TotalPrice를 생성하고 AcceptedEvents 를 생성하는 순간 12만원 기준을 확인해서 증정 이벤트 여부를 결정한다)
  - 증정 이벤트만 할인 전 총 금액으로 적용 여부를 가를 수 있기 떄문

제한 조건을 검증
  - 이벤트 적용 가능한 금액은 총 주문 금액을 기준으로 1만원 이상이다
  - 음료만 주문하는 것은 불가능하다
  - 메뉴는 한 번에 최대 20개까지만 주문이 가능합니다
  - 제한 조건을 토대로 적용하지 못하는 이벤트를 선별한다

구매 내역과 이벤트 적용하기
- 증정메뉴
- 헤택 내역
- 총 혜택 금액
- 할인 후 예상 결제 금액
- 12월 이벤트 배지
