# 프로젝트 목표 - 크리스마스 프로모션
- 미션은 기능 요구 사항, 프로그래밍 요구 사항, 과제 진행 요구 사항 세 가지로 구성되어 있으며 3가지 요구 사항을 만족해야 한다 
- 기능을 구현하기 전에 기능 목록을 만들고, 기능 단위로 커밋 하는 방식으로 진행한다.
- 기능 요구 사항에 기재되지 않은 내용은 스스로 판단하여 구현한다.

## 🚀 기능 요구 사항
12월 이벤트를 위한 개발 요청
- 12월 이벤트 상황에 맞는 프로그램을 개발한다
- 예산 걱정 없이 상한선을 따로 고려하지 않는다
- 메뉴와 달력 이미지를 참고하여 12월 이벤트 계획과 내용을 이해하고 프로그램에 반영할 수 있도록 한다 

### 메뉴
```
<애피타이저>
양송이수프(6,000), 타파스(5,500), 시저샐러드(8,000)

<메인>
티본스테이크(55,000), 바비큐립(54,000), 해산물파스타(35,000), 크리스마스파스타(25,000)

<디저트>
초코케이크(15,000), 아이스크림(5,000)

<음료>
제로콜라(3,000), 레드와인(60,000), 샴페인(25,000)
```

메뉴는 에피타이저, 메인, 디저트, 음료로 구성되어 있으며 종류별 서로 다른 음식 메뉴가 존재한다
- 음식 종류는 서로 다른 음식 메뉴를 가지고 있다 
- 음식 메뉴는 가격을 가지고 있다 ex) 양송이 수프 - 6,000원  

### 12월 이벤트 계획
이벤트의 진행 방식과 목적을 이해한다
- 중복된 할인과 증정을 허용한다 -> 고객들이 혜택을 많이 받는 것을 체감한다 
- 지난 5년 중 최고의 판매 금액을 12월에 달성한다 
- 12월 이벤트 참여 고객의 5%가 내년 1월 새해 이벤트에 참여할 수 있도록 한다 

이벤트 계획은 5가지로 구분할 수 있으며 이벤트 기간, 할인 금액, 증정이 서로 다르게 구성된다

- 크리스마스 디데이 할인 
  - [x] **12.01 - 12.25일까지 진행한다**
  - [x] 할인 금액의 시작은 1000원이다
  - [x] 하루를 지날수록 100원씩 할인 금액이 증가한다 ex) 100원 - 200원 ....
  - [x] 25일 기준 해당 이벤트의 최대 할인 금액은 3400원이다 
  - 총 주문 금액에서 해당 할인 금액을 제외한다

- 평일 할인 (일-목요일)
  - [x] **12.01 - 12.31**일까지 진행한다 
  - [x] **일요일에서 목요일**까지 적용되는 할인이다
  - [x] **디저트 메뉴**를 한 개당 2,023원 할인한다 
  
- 주말 할인 (금-토요일)
  - [x] **12.01 - 12.31**일까지 진행한다
  - [x] **금요일에서 토요일**까지 적용되는 할인이다
  - [x] **메인 메뉴**를 한 개당 2,023원 할인한다

- 특별 할인 
  - [x] **12.03, 10, 17, 24 ,25, 31** 총 6일만 진행한다 
  - [x] **총 주문 금액에서 100원을 할인한다**

- 증정 이벤트 
  - [x] **12.01 - 12.31**일까지 진행한다
  - **할인 전 총 주문 금액** 12만원 이상일 때 적용된다 
  - [x] 샴페인 1개 (25,000원)을 증정한다  

### 헤택 금액에 따른 12월 이벤트 배지 부여
혜택 금액에 따라 서로 다른 이벤트 배지를 부여한다
- [x] 5천원 이상: 별
- [x] 1만원 이상: 트리
- [x] 2만원 이상: 산타

### 12월 이벤트 관련 유의사항
- 이벤트 적용 가능한 금액은 총 주문 금액을 기준으로 1만원 이상이다
- 음료만 주문하는 것은 불가능하다
- 메뉴는 한 번에 최대 20개까지만 주문이 가능합니다 
---

## 흐름 그리고 핵심 기능
```
전체적으로 프로그램의 흐름을 먼저 확인해야 한다. 프로그램의 의도가 무엇인지를 파악해야 한다 
이 프로그램은 대표적으로 메뉴 그리고 이벤트 간의 관계를 표현하는 프로그램이라고 할 수 있다
``` 

메뉴는 메뉴의 종류, 이름, 금액으로 구성되어 있다 --> 메뉴 
주문은 하나의 메뉴 그리고 수량으로 구성되어 있다 --> 주문
주문들이 모여서 하나의 그룹을 형성한다 --> 주문들
날짜 정보가 존재하며, 사용자의 입력으로 부터 날짜 객체를 생성해야 한다 --> 날짜

이벤트는 이벤트 이름, 이벤트의 조건, 이벤트의 할인 및 혜택으로 구성되어 있다 --> 이벤트
이벤트의 조건은 "날짜" 혹은 총주문 금액을 기준으로 적용된다 --> 이벤트의 조건
이벤트의 할인은 "특정 메뉴 종목"에 적용되거나 혹은 일정 금액을 할인한다 --> 이벤트의 효과 
**이벤트의 조건 그리고 효과는 날짜 혹은 주문들과의 협력을 필요로 한다**


### 이벤트 --------> 날짜 + 주문들
- 날짜 정보를 적용해서 이벤트를 적용할 수 있는지의 여부를 확인할 수 있다
  - 적용 가능한 이벤트 목록을 확인할 수 있다
  - 크리스마스 디데이 할인을 제외하고 12월 1일 - 31일까지 적용된다 
    - 디데이 할인만 25일까지 진행한다
    - 나머지 할인은 31일까지 계속해서 진행한다 
- 적용 가능한 이벤트를 통해서 할인 금액을 생성할 수 있다 
  - 할인 금액은 고정 금액 그리고 가변 금액으로 구성되어 있다 
    - 디데이 할인은 날짜에 따라서 100원씩 할인 금액이 올라간다 -> 날짜 정보를 확인한다 
    - 평일에는 '디저트 메뉴' 개수 당 2023원 할인을 받는다 -> 주문들로부터 특정 메뉴의 개수를 얻어야 한다
    - 주말에는 '메인 메뉴' 개수 당 2023원 할인을 받는다 -> 동일
    - 특별 할인은 특정한 날에 1000원 할인을 한다 -> 날짜 정보를 확인한다 
    - 증정 이벤트는 총주문 금액이 12만원 이상인 경우, 샴페인 1개를 증정한다 -> 주문들로부터 총주문 금액을 알아야 한다
이벤트는 최종적으로 이름, 조건 그리고 효과를 가지고 있어야 한다 

``` 
날짜 + 주문들 을 이루는 클래스는 : Reservation
- 날짜 정보를 제공해야 한다 : getAccumulatedDays
- 주문들의 정보에서 특정 메뉴의 개수를 알 수 있어야 한다 getSpecificMenuTypeTotal
  - 각각의 주문에서 특정 메뉴의 개수를 알 수 있어야 한다 
- 주문들의 정보에서 총주문 금액을 알 수 있어야 한다 getTotalPriceWithoutDiscount
  - 각각의 주문에서 주문 금액을 알 수 있어야 한다 
    - 주문은 메뉴의 이름 그리고 수량으로 구성되어 있다 
    - 주문은 메뉴의 가격을 알 수 있어야 한다 
```

### 이벤트 --- 할인 금액 (이벤트별 할인 금액을 알고 있어야 한다)
EnumMap<>을 활용해서 이벤트별 할인 금액을 유지한다 EventStatus
- 이벤트 정보를 활용해서 각 이벤트와 할인 금액 0으로 초기화를 진행한다
- 각 이벤트 별 할인 금액으로 값을 변경한다
- 모든 이벤트를 순회해야 한다 (DiscountType.values())
  - DiscountType (이벤트 관련 모든 정보) - Reservation (날짜, 주문들) 협력을 요구한다 
    - DiscountEvent는 이벤트가 적용 효과와 적용 조건 두가지를 모두 유지하고 있다
    - DiscountEvent를 통해 적용 가능한 이벤트 목록을 조회해야 한다 
      - Reservation으로 부터 날짜 정보를 알 수 있어야 한다 
    - DiscountEvent를 통해 적용 가능한 각각의 이벤트의 할인 금액을 조회한다
      - Reservation으로 부터 주문들 정보를 알 수 있어야 한다
        - 주문들은 주문으로 구성되어 있다
          - 주문은 메뉴 관련 정보와 수량으로 구성되어 있다
          - 메뉴 관련 정보 중 메뉴의 가격 정보를 알 수 있어야 한다 

```
EnumMap<>을 활용해서 이벤트별 할인 금액을 확인할 수 있다 : DiscountChecker
-> 이벤트별 할인 금액 내역을 알 수 있다 
-> 혜택 금액의 총합을 알 수 있다
-> 실제 할인 금액의 총합을 알 수 있다
```

### 출력 예시를 반영한 기능 명세 사항
- 고객들이 식당에 방문할 날짜와 메뉴를 미리 선택하면 이벤트 플래너가 주문과 이벤트 관련 내용을 출력한다 
  - 식당에 방문할 날짜와 메뉴를 입력받는다
  - 주문 메뉴, 할인 전 총주문 금액, 증정 메뉴, 혜택 내역, 총혜택 금액, 할인 후 예상 결제 금액, 12월 이벤트 배지 내용을 출력한다

- 식당 예상 방문 날짜를 입력한다 
  - 예상 방문 날짜는 숫자만 입력받을 수 있다
  - 숫자의 범위는 1일에서 31일까지만 가능하다
    - **예외** 1이상 31이하의 숫자가 아닌 경우
    - **모든 에러 메시지는 "[ERROR]"로 시작하도록 작성한다**
    - **예외 처리** 1 이상 31 이하의 숫자가 아닌 경우, "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."라는 에러 메시지를 출력한다
    - **예외 처리** 재입력을 받는다 

- 주문하실 메뉴와 개수를 입력한다 (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
  - "$메뉴명-$개수" 형태로 입력한다
  - 복수의 메뉴를 주문하는 경우 콤마(',')로 구분해서 입력한다 
  - 메뉴 개수는 1이상의 숫자만 입력할 수 있다
    - **예외** 메뉴의 개수를 숫자로 입력하지 않은 경우
    - **예외** 메뉴의 개수를 0으로 입력한 경우
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 메뉴판에 존재하는 메뉴만 입력할 수 있다
    - **예외** 메뉴판에 존재하지 않는 메뉴를 입력한 경우
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 중복 메뉴를 입력할 수 없다 
    - **예외** 중복 메뉴를 입력한 경우 
    - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
  - 형식에 맞지 않게 입력할 수 없다 
    - **예외** 형식에 맞게 입력하지 않은 경우
      - **예외 1** "$메뉴명-$메뉴 개수"의 형식을 지키지 않은 경우
      - **예외 2** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 구분자를 활용하지 않은 경우 
      - **예외 3** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 정해진 구분자 콤마(',')가 아닌 다른 문자를 명시한 경우 
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
      
- 할인 전 총 주문 금액을 출력한다
  - 할인을 적용하기 전의 가격의 총합을 출력한다 
  - Order 정보를 확인하여 MenuPrice * Quantity 값을 반환한다 
  - 각각의 반환된 값들의 합을 구하고
  - 이를 출력할 수 있도록 한다 - TotalPrice 생성

- 증정 메뉴를 출력한다
  - 1일 ~ 31일까지 진행되는 증정 이벤트의 조건을 충족하면 샴페인을 증정한다
  - 할인 전 최종 금액을 테스트 인자로 전달한다 (인자 값)
    - 할인 받기 전 총 주문 금액이 120000원 이상이 경우
    - 샴페인 (25,000원) 을 증정한다
    
- 혜택 내역을 출력한다 
  - 적용 가능한 혜택을 출력한다
  - 적용하지 못하는 혜택은 출력하지 않는다 
  - 증정된 샴페인이 있다면 포함한다 

- 총 혜택 내역을 출력한다 
  - 이벤트로 할인 받은 금액의 총액을 구한다
  - 증정된 상품의 금액을 포함한다 
    - 증정 이벤트로 샴페인을 증정한 경우 25,000원을 포함하고 출력한다   

- 할인 후 예상 결제 금액을 출력한다 
  - 총 주문 금액에서 할인 금액을 차감한 금액을 출력한다
    - 증정된 샴페인의 가격을 할인 금액에 포함하지 않는다 

- 12월 이벤트 배지를 출력한다
  - 0원 - 4999원 : 없음 
  - 5000원 - 9999원: 별
  - 1만원 이상 - 19999원: 트리
  - 2만원 이상 ~ : 산타 

---

## 단위 테스트 (Unit Test)
모든 메뉴는 메뉴 종류, 메뉴 이름과 메뉴 가격을 포함한다 (Enum으로 표현하자) ex) 에피타이저, 양송이 스프, 6000원
- [x] 메뉴 종류를 관리하는 Enum - MenuType
- [x] 메뉴 이름값을 Wrapping 클래스 - MenuName
- [x] 메뉴의 가격을 Wrapping 클래스 - MenuPrice

모든 이벤트는 적용 기간, 할인 금액
- 이벤트는 이벤트 이름, 이벤트 조건, 이벤트 효과로 구분할 수 있다 
  - 이벤트 조건 그리고 이벤트 효과를 중심으로 구현한다 
  - 이벤트 조건은 날짜 그리고 총 주문 금액으로 구성되어 있다 
    - 이벤트는 날짜와 총 주문 금액을 유지하는 클래스와 협력해야 한다 
- 이벤트 효과는 할인이다 
  - 이벤트 별 적용되는 상품 종류에 따라 할인 금액이 결정된다 
  - 상품 종류와 상관 없이 고정적으로 할인 금액이 결정된다

> 입력된 값을 활용하여 DTO 형성, Mapper 클래스를 활용하여 Entity로 변환한다
```
식당에 방문할 날짜와 메뉴를 입력받는다 (Day)
  - 입력받는 날짜 (DateDTO)
  - 입력받는 메뉴 (MenuDTO)
  - DTO로 받는다
  - DTO to Entity로 변환하는 Mapper 클래스를 유지한다
 ``` 

- [x] DayDTO에서는 공통적인 검증을 진행한다
  - 수를 입력해야 한다
  - **예외** 수가 아닌 문자를 입력한 경우 
  - **예외** 공백 혹은 null을 입력한 경우 

- [x] 예상 방문 날짜는 숫자만 입력받을 수 있다 (Day)
  - 숫자의 범위는 1일에서 31일까지만 가능하다
    - **예외** 1이상 31이하의 숫자가 아닌 경우
    - **모든 에러 메시지는 "[ERROR]"로 시작하도록 작성한다**
    - **예외 처리** 1 이상 31 이하의 숫자가 아닌 경우, "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."라는 에러 메시지를 출력한다
    - **예외 처리** 재입력을 받는다

- [x] 구매 내역을 형성한다 (Order)
  - 구매 내역은 "$메뉴명-$개수" 형태로 입력한다 OrderDTO
    - 복수의 메뉴를 주문하는 경우 콤마(',')로 구분해서 입력한다 - OrderDTO에서 검증 
    - 메뉴 개수는 1이상의 숫자만 입력할 수 있다 - OrderQuantity 에서 검증 
      - **예외** 메뉴의 개수를 숫자로 입력하지 않은 경우 - orderDTO 검증 
      - **예외** 메뉴의 개수를 0으로 입력한 경우 - menuQuantity 검증 
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
    
    - 메뉴판에 존재하는 메뉴만 입력할 수 있다 - MenuProduct 에서 검증 
      - **예외** 메뉴판에 존재하지 않는 메뉴를 입력한 경우 --> MenuProduct Enum에서 처리함 
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
    
    - 중복 메뉴를 입력할 수 없다 - AcceptedOrders 검증
      - **예외** 중복 메뉴를 입력한 경우
      - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다
    
    - 형식에 맞지 않게 입력할 수 없다 - OrderDTO에서 검증한다
      - **예외** 형식에 맞게 입력하지 않은 경우
        - **예외 1** "$메뉴명-$메뉴 개수"의 형식을 지키지 않은 경우
        - **예외 2** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 구분자를 활용하지 않은 경우
        - **예외 3** 형식에 맞게 입력했으나 복수의 메뉴를 주문시 정해진 구분자 콤마(',')가 아닌 다른 문자를 명시한 경우
        - **예외 처리** "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."라는 에러 메시지를 출력하고 재입력 받는다

```
구매 내역을 한꺼번에 테스트를 진행하려다 보니 여러 클래스가 
동시 다발적으로 생성되면서 꼬이기도 쉽고 생각이 복잡해진다 
예외, 성공 케이스를 기준으로 하나의 검증을 마무리 지었다면 
해당 검증에 대한 테스트를 바로 바로 진행하는 것이 좋다
```

- [x] 할인 전 총 주문 금액을 출력한다
  - 메뉴 그리고 수량을 저장하는 Order 클래스를 형성한다  
  - Order의 목록을 유지하는 AcceptedOrders를 형성한다 
  - AcceptedOrders가 유지하는 Order은 MenuProduct, Quantity를 유지한다
    - MenuProduct의 price를 조회한다
    - price와 Quantity를 곱한다 
    - 곱한 값들을 모두 합한다 

- [x] 적용 가능한 이벤트를 조회한다 (DiscountChecker - Reservation)
  - 이벤트 조회에 필요한 정보는 Day, AcceptedOrders 이다  
  - Day, AcceptedOrders를 유지하는 Reservation를 형성한다 
  - 적용 가능한 이벤트를 확인한다
    - Day를 통해서 적용 가능한 이벤트를 조회한다 
      - Promotion 이벤트의 경우 적용이 가능한 이벤트이다
      - 적용은 가능하지만 금액 기준을 넘지 못하면 0원 할인이다
  
- [x] EventStatus를 반환한다
  - 각 이벤트 별 할인 금액을 Map<DiscountType, DiscountPrice> 형태로유지한다 
  - EventStatus로 부터 전체 할인 금액의 합을 반환한다 (TotalPrice)

- [x] 제한 조건을 검증
  - 이벤트 적용 가능한 금액은 총 주문 금액을 기준으로 1만원 이상이다 
    - DiscountChecker는 Reservation을 인자로 받아 이벤트를 조회한다
    - Reservation 총 주문 금액을 먼저 확인한다
      - 총 주문 금액이 1만원보다 작다면 이벤트 조회를 종료한다
  - 음료만 주문하는 것은 불가능하다
  - 메뉴는 한 번에 최대 20개까지만 주문이 가능합니다
  - 위의 2가지 제한 사항은 AcceptedOrders에서 검증한다 
    - AcceptedOrder은 order로 구성되어 있다
      - 각각의 Order은 MenuProduct 그리고 quantity로 구성되어 있다 
      - Order.hasSameMenuType(MenuType) - 음료만 구성되어 있는 경우 예외를 발생한다
      - Order.getMenuQuantity() - MenuType.values() 를 적용해서 음식 개수의 총합을 구하고 20보다 크다면 예외를 발생한다

- [x] 혜택 금액 그리고 실제 할인 금액을 구할 수 있다 EventStatus
  - PROMOTION 존재 여부에 따라 혜택 금액 그리고 할인 금액이 서로 다르다 
    - 존재하면 혜택 금액에는 포함되지만 할인 금액에는 포함되지 않는다
    - 존재하지 않으면 혜택 금액, 할인 금액 모두 포함되지 않는다 
    - **존재 여부를 상관하지 않고 할인 금액을 구하는 경우에는 PROMOTION으로 적용된 할인 금액을 적용하지 않는다**
      - PROMOTION 이벤트를 제외한 합을 구한다 

- [x] 이벤트 배지는 **혜택 금액**을 기준으로 적용한다
  - EventStatus로 부터 혜택 금액을 반환할 수 있다 

---
## Controller flow

```
구매 내역과 이벤트 적용하기
- 증정메뉴
- 헤택 내역
- 총 혜택 금액
- 할인 후 예상 결제 금액
- 12월 이벤트 배지
```

1. 방문 날짜를 입력받는다 - RegisterDayController 
   - DayDTO
2. 주문할 메뉴와 개수를 입력받는다 - RegisterOrderController
   - OrderDTO
3. 주문한 메뉴와 할인 전 총 주문 금액을 출력한다 - DisplayOrderController
   - AcceptedOrders
4. 증정 메뉴, 혜택 내역, 총 혜택 금액, 할인 후 예상 결제 금액을 출력한다 - DisplayBenefitController
   - 증정 메뉴는 EventStatus (PROMOTION_EVENT와 매칭하는 DiscountPrice 확인)
   - 혜택 내역은 EventStatus (DiscountPrice가 0 인 경우 제외하고 모두 출력)
   - 총 혜택 금액 EventStatus (PROMOTION 포함)
   - 할인 후 예상 결제 금액 EventStatus와 협력한다 (할인 전 총 주문 금액 - AcceptedOrders 그리고 실제 할인 금액 - EventStatus) 
5. 12월 이벤트 배지를 출력한다 - DisplayBadgeController
   - EventStatus 로 부터 총 혜택 내역을 반환한다
   - 이벤트 배지를 출력한다 
